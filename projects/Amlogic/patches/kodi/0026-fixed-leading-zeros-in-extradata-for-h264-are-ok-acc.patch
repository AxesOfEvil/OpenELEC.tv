From c5a336a1dc6c579a6e40417d4512540b77b18679 Mon Sep 17 00:00:00 2001
From: davilla <davilla@4pi.com>
Date: Wed, 28 Jan 2015 14:11:17 -0500
Subject: [PATCH 26/27] fixed, leading zeros in extradata for h264 are ok
 according to the spec but hardly ever seen

---
 xbmc/cores/dvdplayer/DVDCodecs/Video/AMLCodec.cpp |    9 ++++++++-
 1 file changed, 8 insertions(+), 1 deletion(-)

diff --git a/xbmc/cores/dvdplayer/DVDCodecs/Video/AMLCodec.cpp b/xbmc/cores/dvdplayer/DVDCodecs/Video/AMLCodec.cpp
index 4f85f78..ecae9de 100644
--- a/xbmc/cores/dvdplayer/DVDCodecs/Video/AMLCodec.cpp
+++ b/xbmc/cores/dvdplayer/DVDCodecs/Video/AMLCodec.cpp
@@ -884,7 +884,7 @@ static int divx3_write_header(am_private_t *para, am_packet_t *pkt)
 static int h264_add_header(unsigned char *buf, int size, am_packet_t *pkt)
 {
     // h264 annex-b
-	  if ((buf[0]==0 && buf[1]==0 && buf[2]==0 && buf[3]==1) && size < HDR_BUF_SIZE) {
+    if ((buf[0]==0 && buf[1]==0 && buf[2]==0 && buf[3]==1) && size < HDR_BUF_SIZE) {
         CLog::Log(LOGDEBUG, "add four byte NAL 264 header in stream before header len=%d",size);
         memcpy(pkt->hdr->data, buf, size);
         pkt->hdr->size = size;
@@ -898,6 +898,13 @@ static int h264_add_header(unsigned char *buf, int size, am_packet_t *pkt)
         return PLAYER_SUCCESS;
     }
 
+    if (size < HDR_BUF_SIZE) {
+        CLog::Log(LOGDEBUG, "add non-standard NAL 264 header in stream before header len=%d",size);
+        memcpy(pkt->hdr->data, buf, size);
+        pkt->hdr->size = size;
+        return PLAYER_SUCCESS;
+    }
+
     return PLAYER_FAILED;
 }
 static int h264_write_header(am_private_t *para, am_packet_t *pkt)
-- 
1.7.10.4

